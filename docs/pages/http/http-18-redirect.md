# HTTP的重定向和跳转

主动跳转：由浏览器的使用者主动发起

被动跳转：由服务器来发起的，浏览器使用者无法控制 ——重定向

1. 重定向的过程

   访问 http://qq.com ->320 -> https://qq.com -> 302 -> https://www.qq.com?fromdefault

   “重定向”实际上发送了两次 HTTP 请求:

   ​	第一个请求返回了 302，带Location字段

   ​	第二个请求就被重定向到了“https://qq.com”（Location地址的URI，可绝对可相对路径）

   302响应：**Location**字段标记了服务器要求重定向的 URI，出现在响应报文里

   注：重定向没有Location字段，直接报错



2. 重定向状态码

   301	永久重定向，会更新书签，更新历史记录，爬虫会更新索引库。下次就直接访问新的URI了

   302	临时重定向，例如网站维护

   303	See Other：类似302，但要求重定向后的请求改为 GET 方法，避免 POST/PUT 重复操作；

   307	Temporary Redirect：类似 302，但重定向后请求里的方法和实体不允许变动，含义比 302 更明确；

   308	类似 307，不允许重定向后的请求变动，但它是 301“永久重定向”的含义。



3. 重定向的应用场景

   a. 资源不可用：例如域名变更、服务器变更、网站改版、系统维护，这些都会导致原 URI 指向的资源无法访问，为了避免出现 404，就需要用重定向跳转到新的 URI

   b. 避免重复：让多个网址都跳转到一个 URI，增加访问入口的同时还不会增加额外的工作量。



4. 重定向的相关问题

   a. 性能损耗

   ​	两次请求 - 应答：虽然 301/302 报文很小，但大量的跳转对服务器的影响也是不可忽视的。站内重定向还好说，可以长连接复用，站外重定向就要开两个连接，如果网络连接质量差，那成本可就高多了，会严重影响用户的体验。

   b. 循环跳转

   ​	浏览器会检测，并报错



### 总结

1. 重定向是服务器发起的跳转，要求客户端改用新的 URI 重新发送请求，通常会自动进行，用户是无感知的；
2. 301/302 是最常用的重定向状态码，分别是“永久重定向”和“临时重定向”；
3. 响应头字段 Location 指示了要跳转的 URI，可以用绝对或相对的形式；
4. 重定向可以把一个 URI 指向另一个 URI，也可以把多个 URI 指向同一个 URI，用途很多；
5. 使用重定向时需要当心性能损耗，还要避免出现循环跳转。


















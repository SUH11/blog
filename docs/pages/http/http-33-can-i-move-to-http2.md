# 我应该迁移到HTTP/2吗？



1. HTTP/2 的优点
   - 完全保持了与 HTTP/1 的兼容
   - 更安全的 HTTP、更快的 HTTPS
   - 一个域名（或者 IP）只用一个 TCP 连接



2. HTTP/2 的缺点
   - “队头阻塞”
     - 如果网络连接质量差，发生丢包，那么 TCP 会等待重传，传输速度就会降低。
   - 在移动网络中发生 IP 地址切换的时候，下层的 TCP 必须重新建连，要再次“握手”，经历“慢启动”，而且之前连接里积累的 HPACK 字典也都消失了，必须重头开始计算，导致带宽浪费和时延。
   - HTTP/2 对一个域名只开一个连接，所以一旦这个连接出问题，那么整个网站的体验也就变差了。



3. 应该迁移到 HTTP/2 吗？
   - 流量大，可迁移
     - HTTP/2 的侧重点是“性能”，所以“是否迁移”就需要在这方面进行评估。如果网站的流量很大，那么 HTTP/2 就可以带来可观的收益
   - 新建网站：可迁移



4. 配置 HTTP/2

   ```nginx
   server {
       listen       443 ssl http2;
   
       server_name  www.xxx.net;
   
       ssl_certificate         xxx.crt;
       ssl_certificate_key     xxx.key;
   ```

   





### 总结

1. HTTP/2 完全兼容 HTTP/1，是“更安全的 HTTP、更快的 HTTPS”，头部压缩、多路复用等技术可以充分利用带宽，降低延迟，从而大幅度提高上网体验；
2. TCP 协议存在“队头阻塞”，所以 HTTP/2 在弱网或者移动网络下的性能表现会不如 HTTP/1；
3. 迁移到 HTTP/2 肯定会有性能提升，但高流量网站效果会更显著；
4. 如果已经升级到了 HTTPS，那么再升级到 HTTP/2 会很简单；
5. TLS 协议提供“ALPN”扩展，让客户端和服务器协商使用的应用层协议，“发现”HTTP/2 服务。



















